name: KubOS Build

on: [push]

jobs:
  action:
    name: Build KubOS image
    runs-on: ubuntu-latest

    steps:
      - name: checkout
        uses: actions/checkout@v3
        with:
          ref: 'buildroot-2022-02'

      - name: echo stuff
        run: |
          ls
          git status
        shell: 'bash'

      - name: download buildroot
        working-directory: ../
        run: |
          wget https://buildroot.org/downloads/buildroot-2022.02.1.tar.gz
          tar xzf buildroot-2022.02.1.tar.gz
          ls

      - name: configure buildroot
        working-directory: ../buildroot-2022.02.1
        run: |
          make BR2_EXTERNAL=../kubos-linux-build/ beaglebone-black_defconfig

      - name: build buildroot
        working-directory: ../buildroot-2022.02.1
        run: make

      - name: save images
        working-directory: ../buildroot-2022.02.1
        run: tar czf images.tgz ./output/images

      - name: checkout
        uses: actions/upload-artifact@v2
        with:
          name: buildroot-output
          path: "./images.tgz"
